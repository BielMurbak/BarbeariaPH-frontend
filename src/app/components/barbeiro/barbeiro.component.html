@if (profissionalLogado) {
<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">
    <img src="assets/logo.png" alt="Logo" class="navbar-logo" />
    <a class="navbar-brand" href="#">PH Barbearia - Área do Barbeiro</a>

    <button
      class="navbar-toggler"
      type="button"
      (click)="toggleMenu()"
      aria-label="Toggle navigation"
    >
      <i class="fas fa-bars"></i>
    </button>

    <div
      class="collapse navbar-collapse justify-content-end"
      [class.show]="menuAberto"
    >
      <div class="navbar-nav">
        <a class="nav-link" (click)="mostrarSecao('agendamentos')" [class.active]="secaoAtiva === 'agendamentos'">Agendamentos</a>
        <a class="nav-link" (click)="mostrarSecao('historico')" [class.active]="secaoAtiva === 'historico'">Histórico</a>
        <a class="nav-link" (click)="mostrarSecao('caixa')" [class.active]="secaoAtiva === 'caixa'">Caixa</a>
        <a class="btn-conta" (click)="sair()">Sair</a>
      </div>
    </div>
  </div>
</nav>

<div class="agendamento-container">
  <div class="container">
    @if (secaoAtiva === 'agendamentos') {
      <h2 class="text-center mb-4">Todos os Agendamentos</h2>
    }
    @if (secaoAtiva === 'historico') {
      <h2 class="text-center mb-4">Histórico de Atendimentos</h2>
    }
    @if (secaoAtiva === 'caixa') {
      <h2 class="text-center mb-4">Relatório de Caixa</h2>
    }
    
    @if (secaoAtiva === 'agendamentos') {
    
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Telefone</th>
            <th scope="col">Serviço</th>
            <th scope="col">Data</th>
            <th scope="col">Hora</th>
            <th scope="col">Local</th>
            <th scope="col">Valor</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
          </tr>
        </thead>
        <tbody>
          @for (agendamento of agendamentos; track agendamento.id) {
          <tr>
            <td>{{ agendamento.clienteEntity.nome || 'N/A' }} {{ agendamento.clienteEntity.sobrenome || '' }}</td>
            <td>{{ agendamento.clienteEntity.celular || 'N/A' }}</td>
            <td>{{ agendamento.profissionalServicoEntity.servicoEntity?.descricao || 'N/A' }}</td>
            <td>{{ agendamento.data }}</td>
            <td>{{ agendamento.horario }}</td>
            <td>{{ agendamento.local }}</td>
            <td>R$ {{ agendamento.profissionalServicoEntity.preco || '0,00' }}</td>
            <td>{{ agendamento.status }}</td>
            <td>
              <div class="actions-column">
                @if (agendamento.id) {
                  <button class="btn btn-edit" (click)="editar(agendamento)">Editar</button>
                  <button class="btn btn-delete" (click)="excluir(agendamento)">Excluir</button>
                }
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
    
    @if (secaoAtiva === 'historico') {
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Telefone</th>
            <th scope="col">Serviço</th>
            <th scope="col">Data</th>
            <th scope="col">Hora</th>
            <th scope="col">Local</th>
            <th scope="col">Valor</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (agendamento of historico; track agendamento.id) {
          <tr>
            <td>{{ agendamento.clienteEntity.nome || 'N/A' }} {{ agendamento.clienteEntity.sobrenome || '' }}</td>
            <td>{{ agendamento.clienteEntity.celular || 'N/A' }}</td>
            <td>{{ agendamento.profissionalServicoEntity.servicoEntity?.descricao || 'N/A' }}</td>
            <td>{{ agendamento.data }}</td>
            <td>{{ agendamento.horario }}</td>
            <td>{{ agendamento.local }}</td>
            <td>R$ {{ agendamento.profissionalServicoEntity.preco || '0,00' }}</td>
            <td><span class="badge bg-success">{{ agendamento.status }}</span></td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
    
    @if (secaoAtiva === 'caixa') {
    <div class="alert alert-success text-center">
      <h4>Relatório de Caixa</h4>
      <p>Funcionalidade em desenvolvimento</p>
    </div>
    }
  </div>
</div>

<!-- Formulário de Edição -->
@if (mostrarFormEdicao && agendamentoEditando) {
<div class="modal-overlay" (click)="cancelarEdicao()">
  <div class="modal-edicao" (click)="$event.stopPropagation()">
    <h3>Editar Agendamento</h3>
    
    <div class="form-group">
      <label>Serviço:</label>
      <select class="form-control" [value]="agendamentoEditando.profissionalServicoEntity.servicoEntity?.descricao || ''" (change)="atualizarServico($any($event.target).value)">
        @for (servico of servicosDisponiveis; track servico.nome) {
          <option [value]="servico.nome" [selected]="servico.nome === agendamentoEditando.profissionalServicoEntity.servicoEntity?.descricao">{{ servico.nome }} - R$ {{ servico.preco.toFixed(2) }}</option>
        }
      </select>
    </div>
    
    <div class="form-group">
      <label>Data:</label>
      <input type="date" class="form-control" [(ngModel)]="agendamentoEditando.data" [min]="getDataMinima()" (change)="validarData($event); buscarHorariosLivres(agendamentoEditando.data, agendamentoEditando.id)" />
    </div>
    
    <div class="form-group">
      <label>Horário:</label>
      <select class="form-control" [(ngModel)]="agendamentoEditando.horario">
        @for (horario of horariosLivres; track horario) {
          <option [value]="horario">{{ horario }}</option>
        }
      </select>
    </div>
    
    <div class="form-group">
      <label>Valor:</label>
      <input type="text" class="form-control" [value]="'R$ ' + (agendamentoEditando.profissionalServicoEntity.preco?.toFixed(2) || '0,00')" readonly />
    </div>
    
    <div class="form-actions">
      <button class="btn btn-primary" (click)="salvarEdicao()">Salvar</button>
      <button class="btn btn-secondary" (click)="cancelarEdicao()">Cancelar</button>
    </div>
  </div>
</div>
}
}