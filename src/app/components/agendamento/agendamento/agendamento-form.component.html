
@if (showModal) {

<div class="modal-overlay" (click)="fecharModal()">
<div class="modal-agendamento" (click)="$event.stopPropagation()">
      
<div class="modal-agendamento-left">
<div class="modal-agendamento-left-mid">


<!-- @IF foram feitos para trocar o texto dinamicamente do lado esquerdo da tela de agendamento
então quando etapaAtual (uma função que guarda qual página a tela da direita se encontra) 
ele muda dinamicamente para parágrafo mais adequado -->

@if (etapaAtual === 'mostrarServicosAdicionas' || mostrarServicosAdicionais) {
<h6>Serviços Adicionais</h6>
<p>Selecione serviços adicionais caso queira incluir no agendamento</p>
}

@if (etapaAtual === 'profissional') {
<h6>Barbeiro</h6>
<p>Selecione o barbeiro que deseja ser atendido.</p>
}

@if (etapaAtual === 'data') {
<h6>Data e Horário</h6>
<p>Datas em verde possuem disponibilidade de horário para agendamento.
</p>
}

@if (etapaAtual === 'horario') {
<h6>Data e Horário</h6>
<p>Datas em verde possuem disponibilidade de horário para agendamento.
</p>
}

@if(etapaAtual==="servicos" && !mostrarServicosAdicionais){
<h6>Serviço</h6>
<p>Selecione o serviço que deseja agendar um horário.</p>
}

@if(etapaAtual==="telefone"){
<h6>Cadastro</h6>
<p>Por favor, digite suas informações de contato para que possamos entrar em contato para confirmar o agendamento.</p>
}

<!---Fim dos if etapaAtual -->

</div>

<div class="modal-agendamento-left-low">
<p>Dúvidas?</p>
<a href="/">Fale conosco!</a>

</div>
</div>

<div class="modal-agendamento-right">
<div class="modal-agendamento-header">

<h4>

<!-- Títulos dinâmicos do header - mudam conforme a etapa atual e submenus ativos -->
<!-- Controla qual título aparece baseado em etapaAtual e variáveis de submenu -->

@if (etapaAtual === 'servicos' && !mostrarCombos && !mostrarTipoCorte && !mostrarServicosAdicionais) {
<span>Selecione o Serviço</span>
}
@if (mostrarCombos) {
<span>Selecione o Combo</span>
}
            
@if (mostrarTipoCorte) {
<span>Selecione o Tipo de Corte</span>
}

@if (mostrarServicosAdicionais) {
<span>Serviços Adicionais</span>
}

@if (etapaAtual === 'profissional') {
<span>Selecione o Profissional</span>
}

@if (etapaAtual === 'data') {
<span>Selecione a Data</span>
}

@if (etapaAtual === 'horario') {
<span>Selecione o Horário</span>
}

@if (etapaAtual === 'telefone') {
<span>Digite seu telefone</span>
}

<!---fim dos if para o titulo das paginas do lado direito do model-->

</h4>

<button class="btn-close" (click)="fecharModal()"></button>

</div>

<!-- Tela principal de serviços - só aparece quando não há submenus ativos
     Filtro inteligente: mostra apenas se estiver em 'servicos' E não estiver 
     mostrando combos OU tipos de corte (evita sobreposição de telas) -->

@if (etapaAtual === 'servicos' && !mostrarCombos && !mostrarTipoCorte && !mostrarServicosAdicionais) {
<div class="modal-agendamento-mid">
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarServico('combo')">
<h3>Combo</h3>
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarServico('corte')">
<h3>Corte</h3>
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarServico('barba')">
<h3>Barba</h3>
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarServico('sobrancelha')">
<h3>Sobrancelha</h3>
</button>

</div>
}

@if (mostrarCombos) {
<div class="modal-agendamento-mid">
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCombo('Cabelo e barba')">
<h3>Cabelo e barba R$ 60,00 </h3>
           
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCombo('Degrade e sobrancelha')">
<h3>Degrade e sobrancelha R$ 45,00 </h3>
             
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCombo('Social e sobrancelha')">
<h3>Social e sobrancelha R$ 40,00 </h3>
            
</button>
<button type="button" class="btn-voltar" (click)="mostrarCombos = false">Voltar</button>
</div>
}

@if (mostrarTipoCorte) {
<div class="modal-agendamento-mid">
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCorte('Cabelo Social')">
<h3>Corte Social  R$ 35,00 </h3>
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCorte('Cabelo')">
<h3>Cabelo  R$ 40,00 </h3>
</button>
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarCorte('Acabamento no Cabelo')">
<h3>Acabamento no Cabelo  R$ 20,00  </h3>
</button>
<button type="button" class="btn-voltar" (click)="mostrarTipoCorte = false">Voltar</button>
</div>
}

@if (mostrarServicosAdicionais) {

<div class="modal-agendamento-mid">

@if (servicoSelecionado !== 'Barba') {
<label class="modal-agendamento-servicos-container">      
<input type="checkbox" [checked]="servicosAdicionaisSelecionados.includes('Barba')"(change)="selecionarServicosAdicionais('Barba')" />
<h3>Barba R$ 35,00</h3>
</label>
}

@if (servicoSelecionado !== 'Sobrancelha'){
<label class="modal-agendamento-servicos-container">       
<input type="checkbox" [checked]="servicosAdicionaisSelecionados.includes('Sobracelha')" (change)="selecionarServicosAdicionais('Sobracelha')" />
<h3>Sobracelha R$ 10,00</h3>
</label>
}
<button type="button" class="btn-continuar" (click)="continuarServicosAdicionais()"> Continuar</button>

<button type="button" class="btn-voltar" (click)="mostrarServicosAdicionais = false">Voltar</button>
</div>

}

 @if (etapaAtual === 'profissional') {
<div class="modal-agendamento-mid">
<button type="button" class="modal-agendamento-servicos-container" (click)="selecionarProfissional('Patrick Henrique')">
<h3>Patrick Henrique</h3>
</button>
<button type="button" class="btn-voltar" (click)="voltarEtapa()">Voltar</button>
</div>
}

@if (etapaAtual === 'data') {
<div class="modal-agendamento-mid">
<div class="calendario">
<div class="calendario-header">
<button (click)="mesAnterior()"><</button>
 <span>{{ mesAtual }} {{ anoAtual }}</span>
<button (click)="proximoMes()">></button>
</div>
              
<div class="calendario-dias">
<div class="dia-semana">Dom</div>
<div class="dia-semana">Seg</div>
<div class="dia-semana">Ter</div>
<div class="dia-semana">Qua</div>
<div class="dia-semana">Qui</div>
<div class="dia-semana">Sex</div>
<div class="dia-semana">Sáb</div>
                
@for (dia of diasDoMes; track dia; let i = $index) {
@if (dia <= 0 || !isDomingo(dia)) {
<button class="dia" 
        [class.disponivel]="dia > 0" 
        [class.selecionado]="dia === diaSelecionado" 
        (click)="selecionarDia(dia)" 
        [disabled]="dia <= 0">{{ dia > 0 ? dia : '' }}</button>
} @else {
<div class="dia"></div>
}
}

</div>
</div>
            
<button type="button" class="btn-voltar" (click)="voltarEtapa()">Voltar</button>
</div>
}

@if (etapaAtual === 'horario') {
<div class="modal-agendamento-mid">
<div class="horarios-scroll">
@for (horario of todosHorarios; track horario) {
@if (!horariosMarcados.includes(horario)) {
<button type="button" 
        class="modal-agendamento-servicos-container" 
        (click)="selecionarHorario(horario)">
<h3>{{horario}}</h3>
</button>
}
}
</div>
<button type="button" class="btn-voltar" (click)="voltarEtapa()">Voltar</button>
</div>
}

@if (etapaAtual === 'telefone') {
<div class="modal-agendamento-mid">
<div class="form-outline" data-mdb-input-init>
<input type="tel" id="typeURL" class="form-control" #telefoneInput (input)="jaCadastrado(telefoneInput.value)" />
<label class="form-label" for="typeURL">Digite seu WhatsApp</label> 
</div>

@if(!jaCadastradoNoBanco){
<div class="form-outline" data-mdb-input-init>
<input type="text" id="nomeInput" class="form-control" #nomeInput/>
<label class="form-label" for="nomeInput">Digite seu Nome </label> 
</div>

<div class="form-outline" data-mdb-input-init>
<input type="text" id="sobrenomeInput" class="form-control" #sobrenomeInput/>
<label class="form-label" for="sobrenomeInput">Sobrenome</label> 
</div>
}



<div class="box-button">
<button type="button" class="btn btn-primary" data-mdb-ripple-init (click)="finalizarAgendamento(telefoneInput)">Agendar</button>
</div>

<div class="box-voltar">
<button type="button" class="btn-voltar" (click)="voltarEtapa()">Voltar</button>

</div>
</div>
}

</div>

@if(resumo){
     
<div class="container-do-resumo">
<div class="resumo-header">
<h3>RESUMO</h3>
</div>
<div class="resumo-content">
<div class="resumo-item">
<span class="resumo-label">SERVIÇO</span>
<span class="resumo-value">{{servicoSelecionado}}</span>
</div>
@if(servicosAdicionaisSelecionados.length > 0) {
<div class="resumo-item">
<span class="resumo-label">ADICIONAIS</span>
<span class="resumo-value">{{servicosAdicionaisSelecionados.join(', ')}}</span>
</div>
}
@if(profissionalSelecionado) {
<div class="resumo-item">
<span class="resumo-label">PROFISSIONAL</span>
<span class="resumo-value">{{profissionalSelecionado}}</span>
</div>
}
@if(dataSelecionada) {
<div class="resumo-item">
<span class="resumo-label">DATA</span>
<span class="resumo-value">{{dataSelecionada}}</span>
</div>
}
@if(horarioSelecionado) {
<div class="resumo-item">
<span class="resumo-label">HORÁRIO</span>
<span class="resumo-value">{{horarioSelecionado}}</span>
</div>
}
<div class="resumo-total">
<span class="resumo-label">TOTAL</span>
<span class="resumo-value">R$ {{calcularTotal()}}</span>
</div>
</div>
</div>
}
</div>
</div>

}
