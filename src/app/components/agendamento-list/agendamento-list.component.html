<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">
    <img src="assets/logo.png" alt="Logo" class="navbar-logo" />
    <a class="navbar-brand" href="#">PH Barbearia Classica</a>

    <button
      class="navbar-toggler"
      type="button"
      (click)="toggleMenu()"
      aria-label="Toggle navigation"
    >
      <i class="fas fa-bars"></i>
    </button>

    <div
      class="collapse navbar-collapse justify-content-end"
      [class.show]="menuAberto"
      id="navbarNavAltMarkup"
    >
      <div class="navbar-nav">
        <a class="nav-link" (click)="mostrarSecao('agendamentos')" [class.active]="secaoAtiva === 'agendamentos'">Agendamentos</a>
        <a class="nav-link" (click)="mostrarSecao('historico')" [class.active]="secaoAtiva === 'historico'">Históricos</a>
        <a class="nav-link" (click)="mostrarSecao('dados')" [class.active]="secaoAtiva === 'dados'">Meus Dados</a>
        <a class="btn-conta" (click)="sair()">Sair</a>
      </div>
    </div>
  </div>
</nav>

<div class="agendamento-container">
  <div class="container">
    @if (secaoAtiva === 'agendamentos') {
      <h2 class="text-center mb-4">Lista de Agendamentos</h2>
    }
    @if (secaoAtiva === 'historico') {
      <h2 class="text-center mb-4">Histórico de Atendimentos</h2>
    }
    @if (secaoAtiva === 'dados') {
      <h2 class="text-center mb-4">Meus Dados</h2>
    }
    
    <!-- Tabela de Agendamentos -->
    @if (secaoAtiva === 'agendamentos') {
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Serviço</th>
            <th scope="col">Data</th>
            <th scope="col">Hora</th>
            <th scope="col">Local</th>
            <th scope="col">Barbeiro</th>
            <th scope="col">Valor</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
          </tr>
        </thead>
        <tbody>
          @for (agendamento of agendamentos; track agendamento.id) {
          <tr>
            <td>{{ agendamento.clienteEntity.nome || 'N/A' }} {{ agendamento.clienteEntity.sobrenome || '' }}</td>
            <td>{{ agendamento.profissionalServicoEntity.servicoEntity?.descricao || 'N/A' }}</td>
            <td>{{ agendamento.data }}</td>
            <td>{{ agendamento.horario }}</td>
            <td>{{ agendamento.local }}</td>
            <td>{{ agendamento.profissionalServicoEntity.profissionalEntity?.nome || 'N/A' }}</td>
            <td>R$ {{ agendamento.profissionalServicoEntity.preco || '0,00' }}</td>
            <td>{{ agendamento.status }}</td>
            <td>
              <div class="actions-column">
                @if (agendamento.id) {
                  <button class="btn btn-edit" (click)="editar(agendamento)">Editar</button>
                  <button class="btn btn-delete" (click)="excluir(agendamento)">Excluir</button>
                }
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
    
    <!-- Formulário de Edição -->
    @if (mostrarFormEdicao && agendamentoEditando) {
    <div class="modal-overlay" (click)="cancelarEdicao()">
      <div class="modal-edicao" (click)="$event.stopPropagation()">
        <h3>Editar Agendamento</h3>
        
        <div class="form-group">
          <label>Serviço:</label>
          <select class="form-control" [value]="agendamentoEditando.profissionalServicoEntity.servicoEntity?.descricao || ''" (change)="atualizarServico($any($event.target).value)">
            @for (servico of servicosDisponiveis; track servico.nome) {
              <option [value]="servico.nome" [selected]="servico.nome === agendamentoEditando.profissionalServicoEntity.servicoEntity?.descricao">{{ servico.nome }} - R$ {{ servico.preco.toFixed(2) }}</option>
            }
          </select>
        </div>
        
        <div class="form-group">
          <label>Data:</label>
          <input type="date" class="form-control" [(ngModel)]="agendamentoEditando.data" [min]="getDataMinima()" (change)="validarData($event); buscarHorariosLivres(agendamentoEditando.data, agendamentoEditando.id)" />
        </div>
        
        <div class="form-group">
          <label>Horário:</label>
          <select class="form-control" [(ngModel)]="agendamentoEditando.horario">
            @for (horario of horariosLivres; track horario) {
              <option [value]="horario">{{ horario }}</option>
            }
          </select>
        </div>
        
        <div class="form-group">
          <label>Valor:</label>
          <input type="text" class="form-control" [value]="'R$ ' + (agendamentoEditando.profissionalServicoEntity.preco?.toFixed(2) || '0,00')" readonly />
        </div>
        
        <div class="form-actions">
          <button class="btn btn-primary" (click)="salvarEdicao()">Salvar</button>
          <button class="btn btn-secondary" (click)="cancelarEdicao()">Cancelar</button>
        </div>
      </div>
    </div>
    }

    <!-- Tabela de Histórico -->
    @if (secaoAtiva === 'historico') {
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Serviço</th>
            <th scope="col">Data</th>
            <th scope="col">Hora</th>
            <th scope="col">Local</th>
            <th scope="col">Barbeiro</th>
            <th scope="col">Valor</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (agendamento of getHistorico(); track agendamento.id) {
          <tr>
            <td>{{ agendamento.clienteEntity.nome || 'N/A' }} {{ agendamento.clienteEntity.sobrenome || '' }}</td>
            <td>{{ agendamento.profissionalServicoEntity.servicoEntity?.descricao || 'N/A' }}</td>
            <td>{{ agendamento.data }}</td>
            <td>{{ agendamento.horario }}</td>
            <td>{{ agendamento.local }}</td>
            <td>{{ agendamento.profissionalServicoEntity.profissionalEntity?.nome || 'N/A' }}</td>
            <td>R$ {{ agendamento.profissionalServicoEntity.preco || '0,00' }}</td>
            <td>
              <span class="badge" [class.bg-success]="agendamento.status === 'CONCLUIDO'" [class.bg-danger]="agendamento.status === 'CANCELADO'">{{ agendamento.status }}</span>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }

    <!-- Dados do Cliente -->
    @if (secaoAtiva === 'dados') {
    <div class="dados-form">
      @if (getClienteLogado(); as cliente) {
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="form-container">
            <div class="form-outline mb-3">
              <input type="text" class="form-control" [(ngModel)]="dadosEdicao.nome" [readonly]="!editandoDados" />
              <label class="form-label">Nome</label>
            </div>
            
            <div class="form-outline mb-3">
              <input type="text" class="form-control" [(ngModel)]="dadosEdicao.sobrenome" [readonly]="!editandoDados" />
              <label class="form-label">Sobrenome</label>
            </div>
            
            <div class="form-outline mb-4">
              <input type="tel" class="form-control" [(ngModel)]="dadosEdicao.celular" [readonly]="!editandoDados" placeholder="(__) _____-____" (input)="formatarTelefone($event)" />
              <label class="form-label">Telefone</label>
            </div>
            
            <div class="text-center">
              @if (!editandoDados) {
                <button class="btn btn-primary" (click)="iniciarEdicao()">Editar</button>
              }
              @if (editandoDados) {
                <button class="btn btn-primary mb-4 w-100" (click)="salvarDados()">Salvar</button>
                <button class="btn btn-secondary w-100" (click)="cancelarEdicaoDados()">Cancelar</button>
              }
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>

<app-agendamento 
  [showModal]="showModalAgendamento" 
  (modalClosed)="fecharModalAgendamento()">
</app-agendamento>

<app-footer (abrirModal)="abrirModalAgendamento()"></app-footer>